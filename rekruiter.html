<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recruiter Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    /* =========================================
       üé® THEME CHAT COLORS (dari variabel kamu)
    ========================================== */
    :root {
      --chat--color-primary: #e74266;
      --chat--color-primary-shade-50: #db4061;
      --chat--color-primary-shade-100: #cf3c5c;
      --chat--color-secondary: #20b69e;
      --chat--color-secondary-shade-50: #1ca08a;
      --chat--color-white: #ffffff;
      --chat--color-light: #f2f4f8;
      --chat--color-light-shade-50: #e6e9f1;
      --chat--color-light-shade-100: #c2c5cc;
      --chat--color-medium: #d2d4d9;
      --chat--color-dark: #101330;
      --chat--color-disabled: #777980;
      --chat--color-typing: #404040;
    }

    /* =========================================
       üß© LAYOUT DASHBOARD RECRUITER
    ========================================== */
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--chat--color-light);
      display: flex;
      min-height: 100vh;
    }
    .sidebar {
      width: 230px;
      background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px 0;
      position: fixed;
      height: 100%;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
    }
    .sidebar h2 { text-align: center; font-size: 22px; margin-bottom: 30px; }
    .menu { list-style: none; padding: 0; margin: 0; flex-grow: 1; }
    .menu li {
      padding: 12px 25px; cursor: pointer; font-weight: 500;
      transition: background 0.3s; display: flex; align-items: center; gap: 10px;
    }
    .menu li:hover, .menu li.active { background: rgba(255,255,255,0.2); }
    .logout-btn {
      background: var(--chat--color-primary);
      margin: 20px; padding: 10px 15px; border-radius: 8px;
      color: white; border: none; font-weight: 600; cursor: pointer;
      transition: 0.3s;
    }
    .logout-btn:hover { background: var(--chat--color-primary-shade-50); }

    .main {
      margin-left: 230px; padding: 40px; flex: 1;
    }
    .header { margin-bottom: 30px; }
    .header h1 { margin: 0; color: var(--chat--color-dark); }

    table {
      width: 100%; border-collapse: collapse; background: white;
      border-radius: 12px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    th, td { padding: 14px; border-bottom: 1px solid #eee; text-align: left; }
    th { background-color: #f1f2f6; }
    tr:hover { background-color: #fafafa; }

    /* LOGIN */
    .login-page {
      margin: auto; background: white; padding: 40px 30px; border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15); text-align: center; max-width: 400px;
    }
    .login-page h2 { margin-bottom: 20px; color: #444; }
    .login-page input {
      width: 100%; padding: 12px; margin-bottom: 15px;
      border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px;
    }
    .login-page button {
      width: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none; color: white; font-size: 16px; font-weight: bold;
      padding: 12px; border-radius: 10px; cursor: pointer; transition: 0.3s;
    }
    .login-page button:hover { transform: translateY(-2px); box-shadow: 0 8px 16px rgba(102,126,234,0.3); }
    .status { margin-top: 10px; font-size: 14px; }
    .status.error { color: #c0392b; } .status.success { color: #27ae60; }
    /* ===== HOME LINK (LOGIN ONLY) ===== */
    .home-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      text-decoration: none;
      font-weight: 600;
      color: #667eea;
      background: #eef2ff;
      padding: 8px 16px;
      border-radius: 999px;
      transition: all 0.3s ease;
      animation: pulseHome 2.5s infinite;
    }
    
    .home-link i {
      font-size: 1.2rem;
    }
    
    .home-link:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      transform: translateY(-2px) scale(1.05);
      box-shadow: 0 8px 20px rgba(102,126,234,0.4);
    }
    
    /* Subtle pulse animation */
    @keyframes pulseHome {
      0% { box-shadow: 0 0 0 0 rgba(102,126,234,0.4); }
      70% { box-shadow: 0 0 0 12px rgba(102,126,234,0); }
      100% { box-shadow: 0 0 0 0 rgba(102,126,234,0); }
    }

    /* PAGE SWITCHING */
    .page { display: none; }
    .page.active { display: block; }

    /* CHAT PAGE STYLING (embedded AI) */
    .chat-container {
      background: var(--chat--color-light);
      border: 1px solid var(--chat--color-light-shade-50);
      border-radius: 12px;
      height: 80vh;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: var(--chat--color-light);
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar" style="display:none;">
    <h2>üëî Recruiter</h2>
    <ul class="menu">
      <li class="active" id="menu-cv" onclick="switchPage('cv')"><i class="bi bi-folder2-open"></i> Lihat CV</li>
      <li id="menu-ai" onclick="switchPage('ai')"><i class="bi bi-cpu"></i> Analisis CV dengan AI</li>
    </ul>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- Main Content -->
  <div class="main" id="mainSection" style="display:none;">
    <!-- Halaman CV -->
    <div id="page-cv" class="page active">
      <div class="header">
        <h1>üìã Daftar CV Pencari Kerja</h1>
        <p style="color:gray;">Data diambil langsung dari Supabase</p>
      </div>
      <table>
        <thead><tr><th>No</th><th>Nama</th><th>Email</th><th>Tanggal Upload</th><th>CV</th></tr></thead>
        <tbody id="cvTableBody"><tr><td colspan="5" style="text-align:center;">‚è≥ Memuat data...</td></tr></tbody>
      </table>
    </div>

    <!-- Halaman AI -->
    <div id="page-ai" class="page">
      <div class="header">
        <h1>üß† Analisis CV dengan AI</h1>
        <p style="color:gray;">Chatbot AI dengan tema kustom</p>
      </div>
      <div class="chat-container">
        <iframe src="https://n8n-w0kfee8uiagq.arman.sumopod.my.id/webhook/286bf5ce-2090-40dc-972a-308d2bed5465/chat" title="Analisis CV dengan AI"></iframe>
      </div>
    </div>
  </div>

  <!-- Login -->
  <div class="login-page" id="loginSection">
     <a href="index.html" class="home-link">
        <i class="bi bi-house-door-fill"></i>
        <span>Home</span>
      </a>
    <h2>üîê Login Perekrut</h2>
    <input type="email" id="recruiterEmail" placeholder="Email" required>
    <input type="password" id="recruiterPassword" placeholder="Password" required>
    <button onclick="loginRecruiter()">Masuk</button>
    <div id="loginStatus" class="status"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://hatsthxismcmiyqbbngq.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhdHN0aHhpc21jbWl5cWJibmdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ5MDk2ODksImV4cCI6MjA3MDQ4NTY4OX0._AKeQOYM94Tshs42rEO7FQheZkkkkULOLuTgQWOMzsY";
    const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function loginRecruiter(){
      const email=document.getElementById("recruiterEmail").value.trim();
      const pass=document.getElementById("recruiterPassword").value.trim();
      const status=document.getElementById("loginStatus");
      status.textContent="‚è≥ Memeriksa kredensial...";status.className="status";
      const {data,error}=await db.from("recruiter").select("*").eq("email",email).single();
      if(error||!data){status.textContent="‚ùå Email tidak ditemukan!";status.className="status error";return;}
      if(data.password!==pass){status.textContent="‚ùå Password salah!";status.className="status error";return;}
      sessionStorage.setItem("recruiter_logged_in","true");showDashboard();
    }

    function showDashboard(){
      document.getElementById("loginSection").style.display="none";
      document.getElementById("sidebar").style.display="flex";
      document.getElementById("mainSection").style.display="block";
      loadCVList();
    }

    function logout(){
      sessionStorage.removeItem("recruiter_logged_in");
      document.getElementById("sidebar").style.display="none";
      document.getElementById("mainSection").style.display="none";
      document.getElementById("loginSection").style.display="block";
      const s=document.getElementById("loginStatus");
      s.textContent="‚úÖ Logout berhasil!";s.className="status success";
    }

    async function loadCVList(){
      const tbody=document.getElementById("cvTableBody");
      tbody.innerHTML=`<tr><td colspan="5" style="text-align:center;">‚è≥ Memuat data...</td></tr>`;
      const {data,error}=await db.from("job_seekers").select("full_name,email,updated_at,cv_url").order("updated_at",{ascending:false});
      if(error){tbody.innerHTML=`<tr><td colspan="5" style="text-align:center;color:red;">Gagal memuat data</td></tr>`;return;}
      if(!data.length){tbody.innerHTML=`<tr><td colspan="5" style="text-align:center;">Belum ada CV diupload</td></tr>`;return;}
      tbody.innerHTML=data.map((r,i)=>`<tr><td>${i+1}</td><td>${r.full_name}</td><td>${r.email}</td><td>${new Date(r.updated_at).toLocaleString("id-ID")}</td><td>${r.cv_url?`<a href="${r.cv_url}" target="_blank">üîó Lihat</a>`:'-'}</td></tr>`).join("");
    }

    function switchPage(page){
      document.querySelectorAll(".menu li").forEach(li=>li.classList.remove("active"));
      document.getElementById("menu-"+page).classList.add("active");
      document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
      document.getElementById("page-"+page).classList.add("active");
    }

    window.addEventListener("DOMContentLoaded",()=>{
      if(sessionStorage.getItem("recruiter_logged_in")==="true"){showDashboard();}
    });
  </script>
</body>
</html>


